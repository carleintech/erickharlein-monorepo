// Supabase PostgreSQL connection
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================
// USER & AUTH (Supabase Auth integrated)
// ============================================

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  avatar_url    String?
  role          UserRole  @default(USER)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt
  
  profile       Profile?
  bookings      Booking[]
  
  @@map("users")
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

// ============================================
// PORTFOLIO PROFILE
// ============================================

model Profile {
  id              String   @id @default(uuid())
  user_id         String   @unique
  user            User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  // Personal
  title           String   @default("Systems Engineer & AI Architect")
  bio             String?  @db.Text
  location        String?  @default("United States")
  timezone        String?  @default("America/New_York")
  
  // Military
  military_branch String?  @default("U.S. Navy")
  military_rank   String?  @default("OS2")
  
  // Professional
  github_url      String?
  linkedin_url    String?
  twitter_url     String?
  resume_url      String?
  
  // Metrics
  years_experience Int     @default(0)
  projects_completed Int   @default(0)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  @@map("profiles")
}

// ============================================
// PROJECTS
// ============================================

model Project {
  id              String         @id @default(uuid())
  slug            String         @unique
  title           String
  tagline         String?
  description     String         @db.Text
  content         String?        @db.Text
  
  // Classification
  category        ProjectCategory
  status          ProjectStatus   @default(IN_PROGRESS)
  visibility      Visibility      @default(PUBLIC)
  
  // Media
  thumbnail_url   String?
  demo_url        String?
  github_url      String?
  
  // Metadata
  start_date      DateTime?
  end_date        DateTime?
  featured        Boolean         @default(false)
  view_count      Int             @default(0)
  
  // Relations
  technologies    ProjectTechnology[]
  
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  
  @@map("projects")
}

enum ProjectCategory {
  AI_ML
  WEB_APP
  MOBILE_APP
  INFRASTRUCTURE
  BLOCKCHAIN
  GOVERNMENT
  MILITARY
  FINTECH
  EDUCATION
  COMMUNITY
}

enum ProjectStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  MAINTENANCE
  ARCHIVED
}

enum Visibility {
  PUBLIC
  PRIVATE
  DRAFT
}

// ============================================
// TECHNOLOGIES & SKILLS
// ============================================

model Technology {
  id              String              @id @default(uuid())
  slug            String              @unique
  name            String
  icon_url        String?
  category        TechCategory
  proficiency     Int                 @default(0)  // 0-100
  
  projects        ProjectTechnology[]
  
  created_at      DateTime            @default(now())
  
  @@map("technologies")
}

enum TechCategory {
  LANGUAGE
  FRAMEWORK
  DATABASE
  CLOUD
  DEVOPS
  AI_ML
  SECURITY
  NETWORKING
  MOBILE
  OTHER
}

model ProjectTechnology {
  project_id      String
  technology_id   String
  
  project         Project    @relation(fields: [project_id], references: [id], onDelete: Cascade)
  technology      Technology @relation(fields: [technology_id], references: [id], onDelete: Cascade)
  
  @@id([project_id, technology_id])
  @@map("project_technologies")
}

// ============================================
// BOOKING SYSTEM (For consultations)
// ============================================

model Booking {
  id              String          @id @default(uuid())
  user_id         String?
  user            User?           @relation(fields: [user_id], references: [id], onDelete: SetNull)
  
  // Contact Info (for non-registered users)
  contact_name    String
  contact_email   String
  contact_phone   String?
  company         String?
  
  // Booking Details
  service_type    ServiceType
  preferred_date  DateTime
  duration        Int             @default(60)  // minutes
  timezone        String          @default("America/New_York")
  
  // Status
  status          BookingStatus   @default(PENDING)
  notes           String?         @db.Text
  admin_notes     String?         @db.Text
  
  // Meeting
  meeting_url     String?
  confirmed_at    DateTime?
  completed_at    DateTime?
  
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  
  @@map("bookings")
}

enum ServiceType {
  CONSULTATION
  TECH_REVIEW
  SYSTEM_DESIGN
  AI_STRATEGY
  MENTORSHIP
  OTHER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

// ============================================
// ACTIVITY LOG (For portfolio analytics)
// ============================================

model ActivityLog {
  id              String          @id @default(uuid())
  event_type      String
  metadata        Json?
  ip_address      String?
  user_agent      String?
  
  created_at      DateTime        @default(now())
  
  @@map("activity_logs")
  @@index([event_type, created_at])
}

// ============================================
// BLOG (Future expansion)
// ============================================

model BlogPost {
  id              String          @id @default(uuid())
  slug            String          @unique
  title           String
  excerpt         String?
  content         String          @db.Text
  cover_image_url String?
  
  published       Boolean         @default(false)
  published_at    DateTime?
  view_count      Int             @default(0)
  
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  
  @@map("blog_posts")
}
